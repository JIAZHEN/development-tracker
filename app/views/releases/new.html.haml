.row
  .col-lg-12
    %h1.page-header Make a Release Request

%form#new_release.form-horizontal{"accept-charset" => "UTF-8", :action => "/releases", :method => "post"}
  %input{:name => "authenticity_token", :type => "hidden", :value => form_authenticity_token}/

  .form-group
    %label.col-sm-2.control-label{:for => "jira_number"} JIRA Number
    .col-sm-2
      %input.form-control{:placeholder => "JIRA Number", :name => "jira_number", :type => "text"}/

  .form-group
    %label.col-sm-2.control-label{:for => "qa"} QA
    .col-sm-2
      %select.form-control
        %option QA

  .form-group.form-header-underline
    %h4.col-sm-2.form-header.control-label
      Application(s)
      %a.plus-link.success{:href => "#", :role => "button"}
        %i.fa.fa-plus-circle.fa-lg

  .form-group
    %label.col-sm-2.control-label{:for => "repository"} Repository
    .col-sm-2
      %input#repository.form-control{:placeholder => "Name of the repository", :autocomplete => "off", "data-provide" => "typeahead", :type => "text", "data-source" => @repositories.to_json, :name => "repository"}/

  .form-group
    %label.col-sm-2.control-label{:for => "branch"} Branch
    .col-sm-2
      %select#branch.form-control
    .col-sm-1
      %a#sync.btn.btn-primary.ladda-button{"data-placement" => "bottom", "data-toggle" => "tooltip", :title => "Update when branch is not listed", "data-style" => "expand-left", :href => "#"}
        %span.ladda-label Sync Github

  .form-group
    %label.col-sm-2.control-label{:for => "repository"} Repository
    .col-sm-2
      %input#repository.form-control{:multiple => "multiple", :placeholder => "Name of the repository", :autocomplete => "off", "data-provide" => "typeahead", :type => "text", "data-source" => @repositories.to_json, :name => "repository"}/

  .form-group
    %label.col-sm-2.control-label{:for => "branch"} Branch
    .col-sm-2
      %select#branch.form-control
    .col-sm-1
      %a#sync.btn.btn-primary.ladda-button{"data-placement" => "bottom", "data-toggle" => "tooltip", :title => "Update when branch is not listed", "data-style" => "expand-left", :href => "#"}
        %span.ladda-label Sync Github

  .form-group
    %label.col-sm-2.control-label{:for => "SHA"} SHA
    .col-sm-2
      %input.form-control{:placeholder => "SHA", :type => "text"}/

  .form-group
    %label.col-sm-2.control-label{:for => "Deloyment Instruction"} Deloyment Instruction
    .col-sm-2
      %textarea.form-control{:rows => "5", :placeholder => "Deloyment Instruction"}

  .form-group
    %label.col-sm-2.control-label{:for => "Rollback Instruction"} Rollback Instruction
    .col-sm-2
      %textarea.form-control{:rows => "5", :placeholder => "Rollback Instruction"}

  .form-group
    .col-sm-offset-2.col-sm-1
      %button.btn.btn-success{:type => "submit"} Submit

:javascript
  Ladda.bind('#sync');
  $('[data-toggle="tooltip"]').tooltip();

  $('#sync').click(function(e){
    e.preventDefault();
    var l = Ladda.create(this);
    l.start();
    var value = $("#repository").val();
    $.post("/get_branches",
      { repository : value, type : "sync" },
      function(response){
        update_branch(response);
      }, "json")
    .always(function() { l.stop(); });
    return false;
  });

  var typingTimer;                // timer identifier
  var doneTypingInterval = 1500;  // time in ms

  $('#repository').keyup(function(){
    clearTimeout(typingTimer);
    typingTimer = setTimeout(doneTyping, doneTypingInterval);
  });

  $('#repository').keydown(function(){
    clearTimeout(typingTimer);
  });

  function doneTyping () {
    var value = $("#repository").val();
    $.post("/get_branches",
      { repository : value, type : "get" },
      function(response){
        update_branch(response);
      }, "json");
  }

  function clearNotification() {
    $('#branch').removeClass('has-success');
  }

  function update_branch(data) {
    var rows = "";
    for (var index in data) {
      rows += "<option value='" + data[index].id + "'> " + data[index].name + "</option>"
    }
    $('#branch').html(rows);
  }

  // plus form
  $('.plus-link').click(function(e){
    console.log('hit');
  });